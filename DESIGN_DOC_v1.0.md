# AIä¹å®«æ ¼3Då‡ºå›¾ç³»ç»Ÿ - è¯¦ç»†è®¾è®¡è¯´æ˜æ–‡æ¡£ v1.0

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **ç¼–å†™æ—¥æœŸ**: 2025-10-18
> **ä½œè€…**: å¤§é“­DAMING
> **é¡¹ç›®çŠ¶æ€**: å·²å®Œæˆå¹¶ä¸Šçº¿

---

## ğŸ“‘ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [éœ€æ±‚åˆ†æ](#2-éœ€æ±‚åˆ†æ)
3. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#3-ç³»ç»Ÿæ¶æ„è®¾è®¡)
4. [åŠŸèƒ½æ¨¡å—è®¾è®¡](#4-åŠŸèƒ½æ¨¡å—è®¾è®¡)
5. [å‰ç«¯è®¾è®¡](#5-å‰ç«¯è®¾è®¡)
6. [åç«¯è®¾è®¡](#6-åç«¯è®¾è®¡)
7. [æ•°æ®åº“è®¾è®¡](#7-æ•°æ®åº“è®¾è®¡)
8. [æ¥å£è®¾è®¡](#8-æ¥å£è®¾è®¡)
9. [ç®—æ³•è®¾è®¡](#9-ç®—æ³•è®¾è®¡)
10. [UI/UXè®¾è®¡](#10-uiuxè®¾è®¡)
11. [å®‰å…¨è®¾è®¡](#11-å®‰å…¨è®¾è®¡)
12. [æ€§èƒ½ä¼˜åŒ–](#12-æ€§èƒ½ä¼˜åŒ–)
13. [æµ‹è¯•æ–¹æ¡ˆ](#13-æµ‹è¯•æ–¹æ¡ˆ)
14. [éƒ¨ç½²æ–¹æ¡ˆ](#14-éƒ¨ç½²æ–¹æ¡ˆ)
15. [è¿ç»´ç›‘æ§](#15-è¿ç»´ç›‘æ§)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

éšç€ç¤¾äº¤åª’ä½“çš„æ™®åŠï¼Œç”¨æˆ·å¯¹ä¸ªæ€§åŒ–å›¾ç‰‡åˆ†äº«çš„éœ€æ±‚æ—¥ç›Šå¢é•¿ã€‚ç‰¹åˆ«æ˜¯æœ‹å‹åœˆä¹å®«æ ¼å›¾ç‰‡ï¼Œå·²æˆä¸ºä¸€ç§æµè¡Œçš„å†…å®¹å±•ç¤ºæ–¹å¼ã€‚ç„¶è€Œï¼Œç°æœ‰å·¥å…·å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- ğŸ’” æ“ä½œå¤æ‚ï¼Œéœ€è¦ä¸“ä¸šè½¯ä»¶
- ğŸ’” ç¼ºä¹åˆ›æ„æ•ˆæœï¼Œåƒç¯‡ä¸€å¾‹
- ğŸ’” æ— æ³•æ™ºèƒ½å¤„ç†ä¸»ä½“æŠ å›¾
- ğŸ’” ç§»åŠ¨ç«¯ä½“éªŒå·®

æœ¬é¡¹ç›®æ—¨åœ¨æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨ã€æ•ˆæœå‡ºä¼—çš„åœ¨çº¿å·¥å…·ï¼Œè®©æ™®é€šç”¨æˆ·ä¹Ÿèƒ½åˆ¶ä½œå‡ºä¸“ä¸šçº§çš„3Då‡ºæ ¼æ•ˆæœå›¾ç‰‡ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

#### æ ¸å¿ƒç›®æ ‡
- âœ… å®ç°ä¹å®«æ ¼è‡ªåŠ¨æ’ç‰ˆ
- âœ… æ”¯æŒä¸»å›¾AIæ™ºèƒ½æŠ å›¾
- âœ… ç”Ÿæˆ3Då‡ºæ ¼æ•ˆæœ
- âœ… æä¾›PC/ç§»åŠ¨ç«¯æ— ç¼ä½“éªŒ

#### æŠ€æœ¯ç›®æ ‡
- âš¡ å‰ç«¯Canvaså®æ—¶å¤„ç†
- ğŸ¤– åç«¯AIæ¨¡å‹é›†æˆ
- ğŸ“± å“åº”å¼å¸ƒå±€è®¾è®¡
- ğŸ”’ æ•°æ®å®‰å…¨ä¸éšç§ä¿æŠ¤

### 1.3 åº”ç”¨åœºæ™¯

| åœºæ™¯ | æè¿° | ç”¨æˆ·ç¾¤ä½“ |
|------|------|---------|
| æœ‹å‹åœˆåˆ†äº« | åˆ¶ä½œä¹å®«æ ¼æ—…æ¸¸ç…§ç‰‡ | æ™®é€šç”¨æˆ· |
| ç”µå•†å®£ä¼  | äº§å“å¤šè§’åº¦å±•ç¤º | å•†å®¶ |
| ä¸ªäººä½œå“é›† | æ‘„å½±ä½œå“æ•´ç† | è®¾è®¡å¸ˆ |
| æ´»åŠ¨æµ·æŠ¥ | æ´»åŠ¨å›¾ç‰‡åˆæˆ | è¿è¥äººå‘˜ |

### 1.4 æŠ€æœ¯æ ˆé€‰å‹

| å±‚çº§ | æŠ€æœ¯ | ç†ç”± |
|------|------|------|
| å‰ç«¯ | HTML5 + CSS3 + JavaScript | è½»é‡ã€å…¼å®¹æ€§å¥½ |
| å›¾åƒå¤„ç† | Canvas API | æµè§ˆå™¨åŸç”Ÿæ”¯æŒ |
| åç«¯ | Flask (Python 3.8+) | å¿«é€Ÿå¼€å‘ã€ç”Ÿæ€ä¸°å¯Œ |
| AIæŠ å›¾ | rembg (UÂ²-Net) | å¼€æºã€æ•ˆæœå¥½ã€æ— éœ€GPU |
| å›¾åƒåº“ | Pillow | Pythonæ ‡å‡†å›¾åƒå¤„ç†åº“ |
| è·¨åŸŸ | Flask-CORS | æ”¯æŒå‰åç«¯åˆ†ç¦» |

---

## 2. éœ€æ±‚åˆ†æ

### 2.1 åŠŸèƒ½æ€§éœ€æ±‚

#### FR-01: å›¾ç‰‡ä¸Šä¼ 
- **éœ€æ±‚æè¿°**: ç”¨æˆ·å¯ä»¥ä¸Šä¼ 9å¼ ä¹å®«æ ¼å›¾ç‰‡å’Œ1å¼ ä¸»å›¾
- **è¾“å…¥**: å›¾ç‰‡æ–‡ä»¶ (JPG/PNG)
- **è¾“å‡º**: å›¾ç‰‡é¢„è§ˆä¸æˆåŠŸæç¤º
- **çº¦æŸ**:
  - ä¹å®«æ ¼æ°å¥½9å¼ 
  - ä¸»å›¾æ°å¥½1å¼ 
  - å•å¼ å›¾ç‰‡ â‰¤ 10MB
  - æ”¯æŒæ‹–æ‹½ä¸Šä¼ 

#### FR-02: ä¹å®«æ ¼ç®¡ç†
- **éœ€æ±‚æè¿°**: ç”¨æˆ·å¯ä»¥è°ƒæ•´ä¹å®«æ ¼å›¾ç‰‡çš„æ’åˆ—é¡ºåº
- **è¾“å…¥**: æ‹–æ‹½æ“ä½œ
- **è¾“å‡º**: å®æ—¶é¢„è§ˆæ›´æ–°
- **çº¦æŸ**:
  - ä»…æ”¯æŒ3x3ç½‘æ ¼å†…éƒ¨äº¤æ¢
  - æ‹–æ‹½æœ‰è§†è§‰åé¦ˆ

#### FR-03: ä¸»å›¾æŠ å›¾
- **éœ€æ±‚æè¿°**: ç³»ç»Ÿè‡ªåŠ¨å»é™¤ä¸»å›¾èƒŒæ™¯
- **è¾“å…¥**: åŸå§‹ä¸»å›¾
- **è¾“å‡º**: é€æ˜èƒŒæ™¯PNG
- **çº¦æŸ**:
  - åç«¯æœåŠ¡å¯ç”¨æ—¶å¯ç”¨
  - å¤„ç†å¤±è´¥é™çº§ä½¿ç”¨åŸå›¾
  - å¤„ç†æ—¶é•¿ < 10ç§’

#### FR-04: æ™ºèƒ½è£å‰ª
- **éœ€æ±‚æè¿°**: è‡ªåŠ¨è£å‰ªæŠ å›¾åçš„é€æ˜åŒºåŸŸ
- **è¾“å…¥**: é€æ˜èƒŒæ™¯PNG
- **è¾“å‡º**: ç´§è´´ä¸»ä½“çš„è£å‰ªå›¾
- **çº¦æŸ**:
  - ä¿ç•™æ‰€æœ‰éé€æ˜åƒç´ 
  - è®¡ç®—æœ€å°åŒ…å›´çŸ©å½¢

#### FR-05: å‚æ•°è°ƒæ•´
- **éœ€æ±‚æè¿°**: ç”¨æˆ·å¯è°ƒæ•´ä¸»å›¾ä½ç½®å’Œå¤§å°
- **è¾“å…¥**: æ»‘å—æ“ä½œ
- **è¾“å‡º**: å®æ—¶é¢„è§ˆ
- **å‚æ•°**:
  - æ°´å¹³åç§»: 0-200px
  - å‚ç›´åç§»: 0-200px
  - ä¸»å›¾ç¼©æ”¾: 0.5-1.5å€

#### FR-06: å›¾ç‰‡åˆæˆ
- **éœ€æ±‚æè¿°**: å°†ä¹å®«æ ¼å’Œä¸»å›¾åˆæˆä¸ºæœ€ç»ˆæ•ˆæœå›¾
- **è¾“å…¥**: ä¹å®«æ ¼æ•°ç»„ã€ä¸»å›¾ã€å‚æ•°
- **è¾“å‡º**: 3:4æ¯”ä¾‹åˆæˆå›¾
- **çº¦æŸ**:
  - ä¹å®«æ ¼åº•éƒ¨å¯¹é½
  - ä¸»å›¾å³ä¸Šè§’å åŠ 
  - æ·»åŠ é˜´å½±æ•ˆæœ

#### FR-07: å›¾ç‰‡ä¸‹è½½
- **éœ€æ±‚æè¿°**: ç”¨æˆ·å¯ä¸‹è½½ç”Ÿæˆçš„å›¾ç‰‡
- **è¾“å…¥**: ç‚¹å‡»ä¸‹è½½æŒ‰é’®
- **è¾“å‡º**: JPEGæ–‡ä»¶
- **çº¦æŸ**:
  - æ ¼å¼: JPEG
  - è´¨é‡: 95%
  - æ–‡ä»¶å: 3D-ä¹å®«æ ¼-{æ—¶é—´æˆ³}.jpg

#### FR-08: é‡ç½®åŠŸèƒ½
- **éœ€æ±‚æè¿°**: ç”¨æˆ·å¯æ¸…ç©ºæ‰€æœ‰æ•°æ®é‡æ–°å¼€å§‹
- **è¾“å…¥**: ç‚¹å‡»é‡ç½®æŒ‰é’®
- **è¾“å‡º**: æ¢å¤åˆå§‹çŠ¶æ€
- **çº¦æŸ**:
  - æ¸…ç©ºæ‰€æœ‰ä¸Šä¼ å›¾ç‰‡
  - é‡ç½®æ‰€æœ‰å‚æ•°
  - æ¸…ç©ºé¢„è§ˆåŒº

### 2.2 éåŠŸèƒ½æ€§éœ€æ±‚

#### NFR-01: æ€§èƒ½è¦æ±‚
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|---------|
| é¡µé¢åŠ è½½æ—¶é—´ | < 2s | Performance API |
| å›¾ç‰‡ä¸Šä¼ å“åº” | < 1s | æ–‡ä»¶è¯»å–æ—¶é•¿ |
| å‚æ•°è°ƒæ•´å»¶è¿Ÿ | < 100ms | requestAnimationFrame |
| æŠ å›¾å¤„ç†æ—¶é•¿ | < 10s | APIå“åº”æ—¶é—´ |
| ä¸‹è½½ç”Ÿæˆæ—¶é—´ | < 1s | Blobåˆ›å»ºæ—¶é•¿ |

#### NFR-02: å…¼å®¹æ€§è¦æ±‚
- **æµè§ˆå™¨**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 11+, Android 10+, iOS 14+
- **å±å¹•åˆ†è¾¨ç‡**: æœ€å° 1024x768

#### NFR-03: å¯ç”¨æ€§è¦æ±‚
- ç”¨æˆ·æ— éœ€åŸ¹è®­å³å¯ä¸Šæ‰‹
- æ“ä½œæ­¥éª¤ â‰¤ 5æ­¥
- é”™è¯¯æç¤ºæ¸…æ™°æ˜äº†
- æ”¯æŒæ‹–æ‹½ç­‰å¿«æ·æ“ä½œ

#### NFR-04: å¯é æ€§è¦æ±‚
- ç³»ç»Ÿå¯ç”¨æ€§ â‰¥ 99.5%
- é”™è¯¯æ¢å¤èƒ½åŠ›: è‡ªåŠ¨é™çº§
- æ•°æ®ä¸¢å¤±ç‡: 0%ï¼ˆæœ¬åœ°å¤„ç†ï¼‰

#### NFR-05: å®‰å…¨æ€§è¦æ±‚
- ç”¨æˆ·æ•°æ®ä¸ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæŠ å›¾é™¤å¤–ï¼‰
- ä¸´æ—¶æ–‡ä»¶2å°æ—¶åè‡ªåŠ¨åˆ é™¤
- é˜²æ­¢æ–‡ä»¶ä¸Šä¼ æ”»å‡»
- CORSè·¨åŸŸä¿æŠ¤

#### NFR-06: å¯ç»´æŠ¤æ€§è¦æ±‚
- ä»£ç æ³¨é‡Šè¦†ç›–ç‡ â‰¥ 30%
- æ¨¡å—åŒ–è®¾è®¡
- éµå¾ªESLintè§„èŒƒ
- Gitç‰ˆæœ¬æ§åˆ¶

---

## 3. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·å±‚ (User)                     â”‚
â”‚              PCæµè§ˆå™¨ / ç§»åŠ¨æµè§ˆå™¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å‰ç«¯å±•ç¤ºå±‚ (View)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ä¸Šä¼ æ¨¡å—    â”‚  é¢„è§ˆæ¨¡å—    â”‚  æ§åˆ¶æ¨¡å—    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            Canvasæ¸²æŸ“å¼•æ“                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP/HTTPS
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯æœåŠ¡å±‚ (Service)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ–‡ä»¶å¤„ç†    â”‚  æŠ å›¾æœåŠ¡    â”‚  å›¾ç‰‡åˆæˆ    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            Flask Webæ¡†æ¶                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AIæ¨¡å‹å±‚ (Model)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            rembg (UÂ²-Net)                   â”‚    â”‚
â”‚  â”‚         Background Removal Model            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æŠ€æœ¯æ¶æ„åˆ†å±‚

#### 3.2.1 è¡¨ç°å±‚ (Presentation Layer)
- **èŒè´£**: ç”¨æˆ·äº¤äº’ã€UIå±•ç¤ºã€äº‹ä»¶å¤„ç†
- **æŠ€æœ¯**: HTML5ã€CSS3ã€JavaScript ES6+
- **ç»„ä»¶**:
  - ä¸Šä¼ ç»„ä»¶ (Upload)
  - ç½‘æ ¼ç»„ä»¶ (Grid)
  - æ»‘å—ç»„ä»¶ (Slider)
  - ç”»å¸ƒç»„ä»¶ (Canvas)

#### 3.2.2 ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- **èŒè´£**: å›¾åƒå¤„ç†ã€æ•°æ®è½¬æ¢ã€çŠ¶æ€ç®¡ç†
- **æŠ€æœ¯**: JavaScript + Canvas API
- **æ¨¡å—**:
  - å›¾ç‰‡åŠ è½½æ¨¡å—
  - æ‹–æ‹½ç®¡ç†æ¨¡å—
  - å›¾åƒåˆæˆæ¨¡å—
  - å‚æ•°è®¡ç®—æ¨¡å—

#### 3.2.3 æ•°æ®è®¿é—®å±‚ (Data Access Layer)
- **èŒè´£**: APIè°ƒç”¨ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®ç¼“å­˜
- **æŠ€æœ¯**: Fetch APIã€FileReader API
- **æœåŠ¡**:
  - ä¸Šä¼ æœåŠ¡
  - æŠ å›¾æœåŠ¡
  - ä¸‹è½½æœåŠ¡

#### 3.2.4 æœåŠ¡å±‚ (Service Layer)
- **èŒè´£**: åç«¯ä¸šåŠ¡å¤„ç†ã€AIæ¨¡å‹è°ƒç”¨
- **æŠ€æœ¯**: Flaskã€Pillowã€rembg
- **API**:
  - /health (å¥åº·æ£€æŸ¥)
  - /remove_bg (æŠ å›¾æ¥å£)
  - /upload (ä¸Šä¼ æ¥å£ï¼Œé¢„ç•™)

### 3.3 éƒ¨ç½²æ¶æ„

#### å¼€å‘ç¯å¢ƒ
```
æœ¬åœ°å¼€å‘æœº
â”œâ”€â”€ å‰ç«¯: Live Server (VSCode)
â”œâ”€â”€ åç«¯: Flask Development Server
â””â”€â”€ æ¨¡å‹: æœ¬åœ°åŠ è½½ rembg
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆå»ºè®®ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç«¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CDN/é™æ€  â”‚ (å‰ç«¯: Vercel/Netlify)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯æœåŠ¡   â”‚ (Flask: Render/Railway)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AIæ¨¡å‹å±‚   â”‚ (rembgæ¨¡å‹ç¼“å­˜)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æ•°æ®æµè®¾è®¡

#### å®Œæ•´æ•°æ®æµç¨‹
```
1. ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
   â†“
2. å‰ç«¯FileReaderè¯»å–
   â†“
3. è½¬æ¢ä¸ºBase64/Blob
   â†“
4. å­˜å‚¨åˆ°stateå¯¹è±¡
   â†“
5. Canvasé¢„è§ˆæ¸²æŸ“
   â†“
6. ç”¨æˆ·ç‚¹å‡»ç”Ÿæˆ
   â†“
7. ä¸»å›¾å‘é€åˆ°åç«¯ (/remove_bg)
   â†“
8. åç«¯rembgå¤„ç†
   â†“
9. è¿”å›é€æ˜PNG
   â†“
10. å‰ç«¯è£å‰ªé€æ˜åŒºåŸŸ
   â†“
11. Canvasåˆæˆä¹å®«æ ¼+ä¸»å›¾
   â†“
12. ç”Ÿæˆæœ€ç»ˆå›¾ç‰‡
   â†“
13. ç”¨æˆ·ä¸‹è½½Blob
```

---

## 4. åŠŸèƒ½æ¨¡å—è®¾è®¡

### 4.1 æ¨¡å—åˆ’åˆ†

```
AIä¹å®«æ ¼3Då‡ºå›¾ç³»ç»Ÿ
â”œâ”€â”€ å‰ç«¯æ¨¡å—
â”‚   â”œâ”€â”€ ä¸Šä¼ ç®¡ç†æ¨¡å— (UploadManager)
â”‚   â”‚   â”œâ”€â”€ ä¹å®«æ ¼ä¸Šä¼ 
â”‚   â”‚   â”œâ”€â”€ ä¸»å›¾ä¸Šä¼ 
â”‚   â”‚   â””â”€â”€ æ–‡ä»¶éªŒè¯
â”‚   â”œâ”€â”€ æ‹–æ‹½äº¤äº’æ¨¡å— (DragDropManager)
â”‚   â”‚   â”œâ”€â”€ ä¹å®«æ ¼æ’åº
â”‚   â”‚   â”œâ”€â”€ æ–‡ä»¶æ‹–å…¥
â”‚   â”‚   â””â”€â”€ è§†è§‰åé¦ˆ
â”‚   â”œâ”€â”€ å›¾åƒå¤„ç†æ¨¡å— (ImageProcessor)
â”‚   â”‚   â”œâ”€â”€ ä¹å®«æ ¼ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ èƒŒæ™¯åˆ›å»º
â”‚   â”‚   â”œâ”€â”€ å›¾ç‰‡åˆæˆ
â”‚   â”‚   â””â”€â”€ é€æ˜è£å‰ª
â”‚   â”œâ”€â”€ å‚æ•°æ§åˆ¶æ¨¡å— (ParameterController)
â”‚   â”‚   â”œâ”€â”€ æ»‘å—æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ å®æ—¶é¢„è§ˆ
â”‚   â”‚   â””â”€â”€ æ•°å€¼æ ¡éªŒ
â”‚   â”œâ”€â”€ æ¸²æŸ“å¼•æ“æ¨¡å— (RenderEngine)
â”‚   â”‚   â”œâ”€â”€ Canvasç®¡ç†
â”‚   â”‚   â”œâ”€â”€ å›¾ç‰‡ç»˜åˆ¶
â”‚   â”‚   â””â”€â”€ é˜´å½±ç‰¹æ•ˆ
â”‚   â””â”€â”€ ä¸‹è½½æ¨¡å— (DownloadManager)
â”‚       â”œâ”€â”€ Blobç”Ÿæˆ
â”‚       â”œâ”€â”€ æ–‡ä»¶å‘½å
â”‚       â””â”€â”€ è§¦å‘ä¸‹è½½
â”œâ”€â”€ åç«¯æ¨¡å—
â”‚   â”œâ”€â”€ WebæœåŠ¡æ¨¡å— (WebServer)
â”‚   â”‚   â”œâ”€â”€ Flaskåº”ç”¨
â”‚   â”‚   â”œâ”€â”€ è·¯ç”±ç®¡ç†
â”‚   â”‚   â””â”€â”€ CORSé…ç½®
â”‚   â”œâ”€â”€ æ–‡ä»¶å¤„ç†æ¨¡å— (FileHandler)
â”‚   â”‚   â”œâ”€â”€ ä¸Šä¼ æ¥æ”¶
â”‚   â”‚   â”œâ”€â”€ æ ¼å¼è½¬æ¢
â”‚   â”‚   â””â”€â”€ ä¸´æ—¶å­˜å‚¨
â”‚   â”œâ”€â”€ AIæŠ å›¾æ¨¡å— (BackgroundRemoval)
â”‚   â”‚   â”œâ”€â”€ rembgè°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ æ¨¡å‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ ç»“æœè¿”å›
â”‚   â””â”€â”€ å®šæ—¶æ¸…ç†æ¨¡å— (CleanupService)
â”‚       â”œâ”€â”€ æ–‡ä»¶æ‰«æ
â”‚       â”œâ”€â”€ è¿‡æœŸåˆ¤æ–­
â”‚       â””â”€â”€ è‡ªåŠ¨åˆ é™¤
â””â”€â”€ å·¥å…·æ¨¡å—
    â”œâ”€â”€ çŠ¶æ€ç®¡ç† (StateManager)
    â”œâ”€â”€ é”™è¯¯å¤„ç† (ErrorHandler)
    â”œâ”€â”€ æ—¥å¿—è®°å½• (Logger)
    â””â”€â”€ æ€§èƒ½ç›‘æ§ (PerformanceMonitor)
```

### 4.2 æ¨¡å—è¯¦ç»†è®¾è®¡

#### 4.2.1 ä¸Šä¼ ç®¡ç†æ¨¡å— (UploadManager)

**èŒè´£**: å¤„ç†ç”¨æˆ·å›¾ç‰‡ä¸Šä¼ ã€æ–‡ä»¶éªŒè¯ã€é¢„è§ˆå±•ç¤º

**ä¸»è¦å‡½æ•°**:
```javascript
class UploadManager {
    // ä¹å®«æ ¼ä¸Šä¼ å¤„ç†
    handleGridUpload(files: File[]): void

    // ä¸»å›¾ä¸Šä¼ å¤„ç†
    handleMainUpload(file: File): void

    // æ–‡ä»¶éªŒè¯
    validateFile(file: File): boolean

    // æ–‡ä»¶è¯»å–
    readFileAsDataURL(file: File): Promise<string>

    // é¢„è§ˆæ˜¾ç¤º
    displayPreview(dataURL: string, index: number): void
}
```

**æ•°æ®ç»“æ„**:
```javascript
{
    gridImages: string[],      // ä¹å®«æ ¼å›¾ç‰‡Base64æ•°ç»„
    mainImage: string | null,  // ä¸»å›¾Base64
    uploadCount: number         // å·²ä¸Šä¼ è®¡æ•°
}
```

**æµç¨‹å›¾**:
```
[ç”¨æˆ·é€‰æ‹©æ–‡ä»¶]
    â†“
[éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°]
    â†“ é€šè¿‡
[FileReaderè¯»å–ä¸ºDataURL]
    â†“
[å­˜å‚¨åˆ°state.gridImages/mainImage]
    â†“
[è°ƒç”¨displayPreviewæ˜¾ç¤º]
    â†“
[æ›´æ–°ä¸Šä¼ è®¡æ•°]
    â†“
[æ£€æŸ¥æ˜¯å¦å¯ç”Ÿæˆ]
```

#### 4.2.2 æ‹–æ‹½äº¤äº’æ¨¡å— (DragDropManager)

**èŒè´£**: å¤„ç†ä¹å®«æ ¼å†…éƒ¨æ‹–æ‹½æ’åºã€æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ 

**ä¸»è¦å‡½æ•°**:
```javascript
class DragDropManager {
    // åˆå§‹åŒ–æ‹–æ‹½äº‹ä»¶
    initDragDrop(): void

    // æ‹–æ‹½å¼€å§‹
    handleDragStart(event: DragEvent): void

    // æ‹–æ‹½æ‚¬åœ
    handleDragOver(event: DragEvent): void

    // æ‹–æ‹½æ”¾ä¸‹
    handleDrop(event: DragEvent): void

    // æ‹–æ‹½ç»“æŸ
    handleDragEnd(event: DragEvent): void

    // äº¤æ¢å›¾ç‰‡
    swapImages(fromIndex: number, toIndex: number): void
}
```

**çŠ¶æ€ç®¡ç†**:
```javascript
{
    draggedCell: HTMLElement | null,  // å½“å‰æ‹–æ‹½å…ƒç´ 
    draggedIndex: number,              // æ‹–æ‹½æºç´¢å¼•
    dropTargetIndex: number            // æ‹–æ‹½ç›®æ ‡ç´¢å¼•
}
```

**äº‹ä»¶æµ**:
```
dragstart â†’ è®°å½•æºå…ƒç´ ï¼Œè®¾ç½®é€æ˜åº¦0.5
    â†“
dragover â†’ é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œæ˜¾ç¤ºè“è‰²è¾¹æ¡†
    â†“
drop â†’ äº¤æ¢æ•°ç»„æ•°æ®ï¼Œåˆ·æ–°UI
    â†“
dragend â†’ æ¢å¤é€æ˜åº¦ï¼Œæ¸…é™¤é«˜äº®
```

#### 4.2.3 å›¾åƒå¤„ç†æ¨¡å— (ImageProcessor)

**èŒè´£**: æ ¸å¿ƒå›¾åƒå¤„ç†é€»è¾‘

**ä¸»è¦å‡½æ•°**:
```javascript
class ImageProcessor {
    // åˆ›å»ºä¹å®«æ ¼
    createNineGrid(images: string[]): Promise<HTMLCanvasElement>

    // åˆ›å»º3:4èƒŒæ™¯
    createBackground(grid: HTMLCanvasElement): Promise<HTMLCanvasElement>

    // åˆæˆæœ€ç»ˆå›¾ç‰‡
    compositeImage(bg: HTMLCanvasElement, main: HTMLImageElement): Promise<HTMLCanvasElement>

    // è£å‰ªé€æ˜åŒºåŸŸ
    cropTransparentArea(img: HTMLImageElement): Promise<HTMLImageElement>

    // è°ƒç”¨åç«¯æŠ å›¾
    removeBackground(dataURL: string): Promise<HTMLImageElement>
}
```

**æ ¸å¿ƒç®—æ³• - åˆ›å»ºä¹å®«æ ¼**:
```javascript
function createNineGrid(images) {
    const cellSize = 300;
    const gap = 10;
    const totalSize = cellSize * 3 + gap * 2;  // 920px

    const canvas = new Canvas(totalSize, totalSize);
    const ctx = canvas.getContext('2d');

    // å¡«å……ç™½è‰²èƒŒæ™¯
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, totalSize, totalSize);

    // ç»˜åˆ¶9å¼ å›¾ç‰‡
    for (let i = 0; i < 9; i++) {
        const row = Math.floor(i / 3);
        const col = i % 3;
        const x = col * (cellSize + gap);
        const y = row * (cellSize + gap);

        ctx.drawImage(images[i], x, y, cellSize, cellSize);
    }

    return canvas;
}
```

**æ ¸å¿ƒç®—æ³• - é€æ˜è£å‰ª**:
```javascript
function cropTransparentArea(img) {
    // 1. åˆ›å»ºä¸´æ—¶canvas
    const tempCanvas = createCanvas(img.width, img.height);
    const ctx = tempCanvas.getContext('2d');
    ctx.drawImage(img, 0, 0);

    // 2. è·å–åƒç´ æ•°æ®
    const imageData = ctx.getImageData(0, 0, img.width, img.height);
    const data = imageData.data;

    // 3. æ‰«æè¾¹ç•Œ
    let minX = img.width, minY = img.height;
    let maxX = 0, maxY = 0;

    for (let y = 0; y < img.height; y++) {
        for (let x = 0; x < img.width; x++) {
            const alpha = data[(y * img.width + x) * 4 + 3];
            if (alpha > 0) {
                minX = Math.min(minX, x);
                minY = Math.min(minY, y);
                maxX = Math.max(maxX, x);
                maxY = Math.max(maxY, y);
            }
        }
    }

    // 4. è£å‰ª
    const cropWidth = maxX - minX + 1;
    const cropHeight = maxY - minY + 1;
    const croppedCanvas = createCanvas(cropWidth, cropHeight);

    croppedCanvas.getContext('2d').drawImage(
        tempCanvas,
        minX, minY, cropWidth, cropHeight,
        0, 0, cropWidth, cropHeight
    );

    return canvasToImage(croppedCanvas);
}
```

#### 4.2.4 å‚æ•°æ§åˆ¶æ¨¡å— (ParameterController)

**èŒè´£**: ç®¡ç†ç”¨æˆ·å‚æ•°è°ƒæ•´

**ä¸»è¦å‡½æ•°**:
```javascript
class ParameterController {
    // åˆå§‹åŒ–æ»‘å—
    initSliders(): void

    // æ›´æ–°åç§»é‡
    updateOffset(axis: 'x' | 'y', value: number): void

    // æ›´æ–°ç¼©æ”¾
    updateScale(value: number): void

    // è§¦å‘å®æ—¶é¢„è§ˆ
    triggerPreview(): void
}
```

**å‚æ•°å®šä¹‰**:
```javascript
{
    offsetX: {
        min: 0,
        max: 200,
        default: 50,
        unit: 'px'
    },
    offsetY: {
        min: 0,
        max: 200,
        default: 50,
        unit: 'px'
    },
    scale: {
        min: 0.5,
        max: 1.5,
        default: 0.9,
        step: 0.1
    }
}
```

#### 4.2.5 æ¸²æŸ“å¼•æ“æ¨¡å— (RenderEngine)

**èŒè´£**: Canvasæ¸²æŸ“ç®¡ç†

**ä¸»è¦å‡½æ•°**:
```javascript
class RenderEngine {
    // åˆå§‹åŒ–Canvas
    initCanvas(width: number, height: number): void

    // æ¸…ç©ºCanvas
    clearCanvas(): void

    // ç»˜åˆ¶å›¾ç‰‡
    drawImage(img: HTMLImageElement, x: number, y: number, w: number, h: number): void

    // æ·»åŠ é˜´å½±
    applyShadow(color: string, blur: number, offsetX: number, offsetY: number): void

    // å¯¼å‡ºä¸ºBlob
    toBlob(type: string, quality: number): Promise<Blob>
}
```

**Canvasä¼˜åŒ–**:
```javascript
// ä½¿ç”¨ç¦»å±Canvasæå‡æ€§èƒ½
const offscreenCanvas = new OffscreenCanvas(width, height);

// ä½¿ç”¨willReadFrequentlyä¼˜åŒ–è¯»å–
const ctx = canvas.getContext('2d', { willReadFrequently: true });

// æ‰¹é‡ç»˜åˆ¶å‡å°‘é‡ç»˜
ctx.save();
// ... å¤šæ¬¡ç»˜åˆ¶
ctx.restore();
```

---

## 5. å‰ç«¯è®¾è®¡

### 5.1 é¡µé¢ç»“æ„è®¾è®¡

#### 5.1.1 HTMLç»“æ„æ ‘
```html
<body>
  <div class="container">
    <header>
      <h1>æ ‡é¢˜</h1>
      <p>å‰¯æ ‡é¢˜</p>
    </header>

    <main class="main-layout">
      <!-- å·¦ä¾§é¢æ¿ -->
      <div class="left-panel">
        <section class="grid-upload-section">
          <h2>ä¹å®«æ ¼å›¾ç‰‡ (9å¼ )</h2>
          <div class="upload-box"></div>
          <div class="grid-container">
            <div class="grid-cell" data-index="0-8"></div>
          </div>
        </section>

        <section class="main-upload-section">
          <h2>ä¸»å›¾ (1å¼ )</h2>
          <div class="upload-box small"></div>
          <div class="main-preview"></div>
        </section>
      </div>

      <!-- å³ä¾§é¢æ¿ -->
      <div class="right-panel">
        <section class="control-panel">
          <h2>è°ƒæ•´å‚æ•°</h2>
          <div class="controls">
            <div class="control-item">æ»‘å—</div>
          </div>
          <button class="btn-generate">ç”Ÿæˆ</button>
        </section>

        <section class="result-section">
          <h2>ç”Ÿæˆç»“æœ</h2>
          <div class="result-container">
            <canvas id="resultCanvas"></canvas>
            <div class="result-placeholder"></div>
          </div>
          <div class="result-actions">
            <button class="btn-download">ä¸‹è½½</button>
            <button class="btn-reset">é‡ç½®</button>
          </div>
        </section>
      </div>
    </main>

    <footer>ç‰ˆæƒä¿¡æ¯</footer>
  </div>
</body>
```

#### 5.1.2 ç»„ä»¶å±‚æ¬¡ç»“æ„
```
Container (å®¹å™¨)
â”œâ”€â”€ Header (å¤´éƒ¨)
â”‚   â”œâ”€â”€ Title (æ ‡é¢˜)
â”‚   â””â”€â”€ Subtitle (å‰¯æ ‡é¢˜)
â”œâ”€â”€ MainLayout (ä¸»å¸ƒå±€)
â”‚   â”œâ”€â”€ LeftPanel (å·¦ä¾§é¢æ¿)
â”‚   â”‚   â”œâ”€â”€ GridUploadSection (ä¹å®«æ ¼ä¸Šä¼ åŒº)
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadBox (ä¸Šä¼ æ¡†)
â”‚   â”‚   â”‚   â””â”€â”€ GridContainer (ä¹å®«æ ¼å®¹å™¨)
â”‚   â”‚   â”‚       â””â”€â”€ GridCell x9 (å•å…ƒæ ¼)
â”‚   â”‚   â””â”€â”€ MainUploadSection (ä¸»å›¾ä¸Šä¼ åŒº)
â”‚   â”‚       â”œâ”€â”€ UploadBox (ä¸Šä¼ æ¡†)
â”‚   â”‚       â””â”€â”€ MainPreview (ä¸»å›¾é¢„è§ˆ)
â”‚   â””â”€â”€ RightPanel (å³ä¾§é¢æ¿)
â”‚       â”œâ”€â”€ ControlPanel (æ§åˆ¶é¢æ¿)
â”‚       â”‚   â”œâ”€â”€ Controls (æ§åˆ¶é¡¹)
â”‚       â”‚   â”‚   â””â”€â”€ ControlItem x3 (æ»‘å—)
â”‚       â”‚   â””â”€â”€ GenerateButton (ç”ŸæˆæŒ‰é’®)
â”‚       â””â”€â”€ ResultSection (ç»“æœåŒº)
â”‚           â”œâ”€â”€ ResultContainer (ç»“æœå®¹å™¨)
â”‚           â”‚   â”œâ”€â”€ ResultCanvas (ç”»å¸ƒ)
â”‚           â”‚   â””â”€â”€ Placeholder (å ä½ç¬¦)
â”‚           â””â”€â”€ ResultActions (æ“ä½œæŒ‰é’®)
â”‚               â”œâ”€â”€ DownloadButton (ä¸‹è½½)
â”‚               â””â”€â”€ ResetButton (é‡ç½®)
â””â”€â”€ Footer (åº•éƒ¨)
```

### 5.2 CSSè®¾è®¡è§„èŒƒ

#### 5.2.1 é¢œè‰²ç³»ç»Ÿ
```css
:root {
    /* ä¸»è‰²è°ƒ */
    --primary-color: #667eea;
    --primary-dark: #764ba2;

    /* ä¸­æ€§è‰² */
    --text-primary: #333;
    --text-secondary: #666;
    --text-hint: #999;
    --border-color: #ddd;
    --bg-light: #f8f9ff;
    --bg-gray: #f5f5f5;

    /* åŠŸèƒ½è‰² */
    --success: #52c41a;
    --warning: #faad14;
    --error: #f5222d;

    /* é˜´å½± */
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
    --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
}
```

#### 5.2.2 å­—ä½“ç³»ç»Ÿ
```css
:root {
    --font-family-base: -apple-system, BlinkMacSystemFont,
                        'Segoe UI', 'PingFang SC',
                        'Hiragino Sans GB', 'Microsoft YaHei',
                        sans-serif;

    --font-size-xs: 0.75rem;   /* 12px */
    --font-size-sm: 0.875rem;  /* 14px */
    --font-size-md: 1rem;      /* 16px */
    --font-size-lg: 1.125rem;  /* 18px */
    --font-size-xl: 1.5rem;    /* 24px */
    --font-size-2xl: 2rem;     /* 32px */

    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-bold: 700;
}
```

#### 5.2.3 é—´è·ç³»ç»Ÿ
```css
:root {
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --spacing-2xl: 48px;
}
```

#### 5.2.4 å¸ƒå±€æ–­ç‚¹
```css
/* å“åº”å¼æ–­ç‚¹ */
@media (max-width: 768px) {   /* æ‰‹æœº */
    .main-layout { grid-template-columns: 1fr; }
}

@media (min-width: 769px) and (max-width: 1024px) {  /* å¹³æ¿ */
    .main-layout { grid-template-columns: 1fr; }
}

@media (min-width: 1025px) {  /* PC */
    .main-layout { grid-template-columns: 1fr 2fr; }
}
```

### 5.3 JavaScriptè®¾è®¡æ¨¡å¼

#### 5.3.1 çŠ¶æ€ç®¡ç†æ¨¡å¼
```javascript
// å…¨å±€çŠ¶æ€å¯¹è±¡
const state = {
    gridImages: [],
    mainImage: null,
    offsetX: 50,
    offsetY: 50,
    scale: 0.9,
    useBackend: false,
    isGenerated: false
};

// çŠ¶æ€æ›´æ–°å‡½æ•°
function setState(updates) {
    Object.assign(state, updates);
    onStateChange();
}

// çŠ¶æ€ç›‘å¬
function onStateChange() {
    // è§¦å‘UIæ›´æ–°
    updateUI();
    // è§¦å‘é¢„è§ˆåˆ·æ–°
    if (state.isGenerated) {
        updatePreview();
    }
}
```

#### 5.3.2 äº‹ä»¶å§”æ‰˜æ¨¡å¼
```javascript
// ç»Ÿä¸€äº‹ä»¶å¤„ç†
document.addEventListener('click', (e) => {
    const target = e.target;

    if (target.matches('.upload-box')) {
        handleUploadClick(e);
    } else if (target.matches('.grid-cell')) {
        handleCellClick(e);
    } else if (target.matches('.btn-generate')) {
        handleGenerate(e);
    }
});
```

#### 5.3.3 Promiseé“¾å¼è°ƒç”¨
```javascript
async function generateImage() {
    try {
        const grid = await createNineGrid(state.gridImages);
        const background = await createBackground(grid);
        const mainImg = await loadImage(state.mainImage);

        if (state.useBackend) {
            mainImg = await removeBackground(mainImg);
            mainImg = await cropTransparentArea(mainImg);
        }

        const result = await compositeImage(background, mainImg);
        displayResult(result);
    } catch (error) {
        handleError(error);
    }
}
```

---

## 6. åç«¯è®¾è®¡

### 6.1 Flaskåº”ç”¨ç»“æ„

```python
# app.py - ä¸»åº”ç”¨æ–‡ä»¶

from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
from PIL import Image
import io
import os
from rembg import remove

app = Flask(__name__)
CORS(app)

# é…ç½®
UPLOAD_FOLDER = 'temp_images'
MAX_FILE_SIZE = 10 * 1024 * 1024
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg'}

# è·¯ç”±å®šä¹‰
@app.route('/health', methods=['GET'])
def health():
    """å¥åº·æ£€æŸ¥"""
    return jsonify({"status": "ok"})

@app.route('/remove_bg', methods=['POST'])
def remove_bg():
    """æŠ å›¾æ¥å£"""
    # å®ç°é€»è¾‘
    pass

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
```

### 6.2 APIæ¥å£è®¾è®¡

#### 6.2.1 å¥åº·æ£€æŸ¥æ¥å£

**æ¥å£**: `GET /health`

**æè¿°**: æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

**è¯·æ±‚**: æ— å‚æ•°

**å“åº”**:
```json
{
    "status": "ok",
    "message": "æœåŠ¡è¿è¡Œæ­£å¸¸",
    "version": "1.0.0"
}
```

**çŠ¶æ€ç **:
- 200: æœåŠ¡æ­£å¸¸

#### 6.2.2 æŠ å›¾æ¥å£

**æ¥å£**: `POST /remove_bg`

**æè¿°**: å¯¹ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡ŒèƒŒæ™¯ç§»é™¤

**è¯·æ±‚**:
- Content-Type: `multipart/form-data`
- Body:
  ```
  image: File (å›¾ç‰‡æ–‡ä»¶)
  ```

**å“åº”**:
- Content-Type: `image/png`
- Body: PNGå›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®

**çŠ¶æ€ç **:
- 200: å¤„ç†æˆåŠŸ
- 400: è¯·æ±‚é”™è¯¯ï¼ˆæ— æ–‡ä»¶ã€æ ¼å¼é”™è¯¯ï¼‰
- 500: æœåŠ¡å™¨é”™è¯¯

**é”™è¯¯å“åº”**:
```json
{
    "error": "é”™è¯¯ä¿¡æ¯"
}
```

**å®ç°ä»£ç **:
```python
@app.route('/remove_bg', methods=['POST'])
def remove_bg():
    try:
        # éªŒè¯æ–‡ä»¶
        if 'image' not in request.files:
            return jsonify({"error": "æ²¡æœ‰å›¾ç‰‡ä¸Šä¼ "}), 400

        file = request.files['image']

        # è¯»å–å›¾ç‰‡
        input_image = file.read()

        # è°ƒç”¨rembg
        output_image = remove(input_image)

        # è¿”å›ç»“æœ
        return send_file(
            io.BytesIO(output_image),
            mimetype='image/png',
            as_attachment=False
        )
    except Exception as e:
        return jsonify({"error": str(e)}), 500
```

### 6.3 æ–‡ä»¶å¤„ç†è®¾è®¡

#### 6.3.1 ä¸´æ—¶æ–‡ä»¶ç®¡ç†
```python
import threading
import time
from datetime import datetime, timedelta

def clean_old_files():
    """å®šæ—¶æ¸…ç†2å°æ—¶å‰çš„ä¸´æ—¶æ–‡ä»¶"""
    while True:
        try:
            now = datetime.now()
            for filename in os.listdir(UPLOAD_FOLDER):
                filepath = os.path.join(UPLOAD_FOLDER, filename)
                if os.path.isfile(filepath):
                    file_time = datetime.fromtimestamp(
                        os.path.getmtime(filepath)
                    )
                    if now - file_time > timedelta(hours=2):
                        os.remove(filepath)
                        print(f"å·²æ¸…ç†æ–‡ä»¶: {filename}")
        except Exception as e:
            print(f"æ¸…ç†æ–‡ä»¶æ—¶å‡ºé”™: {e}")

        time.sleep(3600)  # æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡

# å¯åŠ¨æ¸…ç†çº¿ç¨‹
cleanup_thread = threading.Thread(
    target=clean_old_files,
    daemon=True
)
cleanup_thread.start()
```

#### 6.3.2 æ–‡ä»¶éªŒè¯
```python
def allowed_file(filename):
    """æ£€æŸ¥æ–‡ä»¶æ‰©å±•å"""
    return '.' in filename and \
           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

def validate_file_size(file):
    """æ£€æŸ¥æ–‡ä»¶å¤§å°"""
    file.seek(0, os.SEEK_END)
    file_size = file.tell()
    file.seek(0)
    return file_size <= MAX_FILE_SIZE
```

### 6.4 AIæ¨¡å‹é›†æˆ

#### 6.4.1 rembgé…ç½®
```python
from rembg import remove, new_session

# åˆ›å»ºä¼šè¯ï¼ˆå¯é€‰ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼‰
session = new_session("u2net")

def remove_background(image_data):
    """ä½¿ç”¨rembgå»é™¤èƒŒæ™¯"""
    return remove(
        image_data,
        session=session,
        alpha_matting=True,  # å¯ç”¨alphaæŠ å›¾ä¼˜åŒ–
        alpha_matting_foreground_threshold=240,
        alpha_matting_background_threshold=10,
        alpha_matting_erode_size=10
    )
```

#### 6.4.2 æ¨¡å‹æ€§èƒ½ä¼˜åŒ–
```python
# æ¨¡å‹ç¼“å­˜
from functools import lru_cache

@lru_cache(maxsize=1)
def get_model_session():
    """ç¼“å­˜æ¨¡å‹ä¼šè¯"""
    return new_session("u2net")

# æ‰¹é‡å¤„ç†
def batch_remove_bg(images):
    """æ‰¹é‡å¤„ç†å¤šå¼ å›¾ç‰‡"""
    session = get_model_session()
    results = []
    for img in images:
        result = remove(img, session=session)
        results.append(result)
    return results
```

---

## 7. æ•°æ®åº“è®¾è®¡

**æ³¨**: å½“å‰ç‰ˆæœ¬ (v1.0) ä¸ºçº¯å‰ç«¯å¤„ç† + æ— çŠ¶æ€åç«¯ï¼Œ**ä¸éœ€è¦æ•°æ®åº“**ã€‚

### 7.1 æ— æ•°æ®åº“æ–¹æ¡ˆ

#### ä¼˜åŠ¿
- âœ… ç®€åŒ–éƒ¨ç½²ï¼Œæ— éœ€ç»´æŠ¤æ•°æ®åº“
- âœ… é™ä½æˆæœ¬ï¼Œæ— å­˜å‚¨è´¹ç”¨
- âœ… ä¿æŠ¤éšç§ï¼Œæ•°æ®ä¸è½ç›˜
- âœ… å¤©ç„¶åˆ†å¸ƒå¼ï¼Œæ— å•ç‚¹æ•…éšœ

#### æ•°æ®å­˜å‚¨ç­–ç•¥
| æ•°æ®ç±»å‹ | å­˜å‚¨ä½ç½® | ç”Ÿå‘½å‘¨æœŸ |
|---------|---------|---------|
| ä¹å®«æ ¼å›¾ç‰‡ | å‰ç«¯å†…å­˜ (state.gridImages) | ä¼šè¯çº§ |
| ä¸»å›¾ | å‰ç«¯å†…å­˜ (state.mainImage) | ä¼šè¯çº§ |
| ç”Ÿæˆç»“æœ | Canvas (å¯å¯¼å‡º) | ä¼šè¯çº§ |
| ä¸´æ—¶æŠ å›¾æ–‡ä»¶ | åç«¯ä¸´æ—¶ç›®å½• | 2å°æ—¶ |

### 7.2 æœªæ¥æ‰©å±•æ–¹æ¡ˆï¼ˆV2.0+ï¼‰

å¦‚éœ€æ·»åŠ ç”¨æˆ·ç³»ç»Ÿã€å†å²è®°å½•ç­‰åŠŸèƒ½ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ•°æ®åº“è®¾è®¡ï¼š

#### ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP NULL
);
```

#### ä½œå“è¡¨ (works)
```sql
CREATE TABLE works (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    title VARCHAR(100),
    grid_images JSON NOT NULL,  -- ä¹å®«æ ¼å›¾ç‰‡URLæ•°ç»„
    main_image VARCHAR(255) NOT NULL,
    result_image VARCHAR(255) NOT NULL,
    parameters JSON,  -- å­˜å‚¨å‚æ•°è®¾ç½®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

## 8. æ¥å£è®¾è®¡

### 8.1 RESTful APIè§„èŒƒ

#### 8.1.1 URLè®¾è®¡è§„åˆ™
- ä½¿ç”¨åè¯å¤æ•°è¡¨ç¤ºèµ„æº
- ä½¿ç”¨HTTPåŠ¨è¯è¡¨ç¤ºæ“ä½œ
- ä½¿ç”¨å°å†™å­—æ¯ï¼Œå•è¯ç”¨è¿å­—ç¬¦åˆ†éš”

#### 8.1.2 HTTPçŠ¶æ€ç 
| çŠ¶æ€ç  | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|-------|------|---------|
| 200 | OK | è¯·æ±‚æˆåŠŸ |
| 201 | Created | èµ„æºåˆ›å»ºæˆåŠŸ |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 500 | Internal Server Error | æœåŠ¡å™¨é”™è¯¯ |

### 8.2 APIæ¥å£æ¸…å•

| æ¥å£ | æ–¹æ³• | æè¿° | çŠ¶æ€ |
|------|-----|------|------|
| /health | GET | å¥åº·æ£€æŸ¥ | âœ… å·²å®ç° |
| /remove_bg | POST | AIæŠ å›¾ | âœ… å·²å®ç° |
| /upload | POST | æ–‡ä»¶ä¸Šä¼  | â³ é¢„ç•™ |
| /compose | POST | å›¾ç‰‡åˆæˆ | â³ é¢„ç•™ |
| /download/:id | GET | ä¸‹è½½ç»“æœ | â³ é¢„ç•™ |

### 8.3 å‰ç«¯è°ƒç”¨ç¤ºä¾‹

#### 8.3.1 æŠ å›¾APIè°ƒç”¨
```javascript
async function callRemoveBgAPI(imageDataUrl) {
    // 1. è½¬æ¢ä¸ºBlob
    const blob = await dataURLtoBlob(imageDataUrl);

    // 2. æ„å»ºFormData
    const formData = new FormData();
    formData.append('image', blob, 'image.jpg');

    // 3. å‘é€è¯·æ±‚
    const response = await fetch('http://localhost:5000/remove_bg', {
        method: 'POST',
        body: formData
    });

    // 4. å¤„ç†å“åº”
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }

    // 5. è·å–ç»“æœ
    const resultBlob = await response.blob();
    const resultUrl = URL.createObjectURL(resultBlob);

    // 6. åŠ è½½å›¾ç‰‡
    const img = await loadImage(resultUrl);

    // 7. æ¸…ç†URL
    URL.revokeObjectURL(resultUrl);

    return img;
}
```

#### 8.3.2 é”™è¯¯å¤„ç†
```javascript
try {
    const result = await callRemoveBgAPI(imageData);
    displayResult(result);
} catch (error) {
    if (error.message.includes('Failed to fetch')) {
        console.error('åç«¯æœåŠ¡ä¸å¯ç”¨ï¼Œä½¿ç”¨åŸå›¾');
        fallbackToOriginal();
    } else {
        console.error('æŠ å›¾å¤±è´¥:', error);
        showErrorMessage('å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
}
```

---

## 9. ç®—æ³•è®¾è®¡

### 9.1 æ ¸å¿ƒç®—æ³•æ¦‚è§ˆ

| ç®—æ³•åç§° | å¤æ‚åº¦ | åŠŸèƒ½ | ä¼˜åŒ–ç‚¹ |
|---------|--------|------|--------|
| ä¹å®«æ ¼ç”Ÿæˆ | O(9) | æ‹¼æ¥9å¼ å›¾ | Canvasæ‰¹é‡ç»˜åˆ¶ |
| èƒŒæ™¯åˆ›å»º | O(1) | åˆ›å»º3:4ç”»å¸ƒ | é¢„è®¡ç®—å°ºå¯¸ |
| é€æ˜è£å‰ª | O(nÃ—m) | æ‰«æåƒç´  | æ—©åœä¼˜åŒ– |
| å›¾ç‰‡ç¼©æ”¾ | O(1) | ç­‰æ¯”è®¡ç®— | ç¼“å­˜æ¯”ä¾‹ |
| é˜´å½±ç»˜åˆ¶ | O(1) | Canvas API | ç¡¬ä»¶åŠ é€Ÿ |

### 9.2 é€æ˜åŒºåŸŸè£å‰ªç®—æ³•è¯¦è§£

#### 9.2.1 ç®—æ³•æè¿°
```
è¾“å…¥: é€æ˜èƒŒæ™¯PNGå›¾ç‰‡
è¾“å‡º: è£å‰ªåçš„ç´§å‡‘å›¾ç‰‡

æ­¥éª¤:
1. å°†å›¾ç‰‡ç»˜åˆ¶åˆ°Canvas
2. è·å–åƒç´ æ•°æ®ImageData
3. éå†æ‰€æœ‰åƒç´ ï¼Œæ‰¾åˆ°alpha > 0çš„è¾¹ç•Œ
4. è®¡ç®—æœ€å°åŒ…å›´çŸ©å½¢(minX, minY, maxX, maxY)
5. è£å‰ªå¹¶è¿”å›æ–°å›¾ç‰‡
```

#### 9.2.2 ä¼ªä»£ç 
```
function cropTransparentArea(image):
    canvas = createCanvas(image.width, image.height)
    ctx = canvas.getContext('2d')
    ctx.drawImage(image, 0, 0)

    imageData = ctx.getImageData(0, 0, image.width, image.height)
    data = imageData.data

    minX = image.width
    minY = image.height
    maxX = 0
    maxY = 0

    for y from 0 to image.height - 1:
        for x from 0 to image.width - 1:
            index = (y * image.width + x) * 4
            alpha = data[index + 3]

            if alpha > 0:
                minX = min(minX, x)
                minY = min(minY, y)
                maxX = max(maxX, x)
                maxY = max(maxY, y)

    if minX > maxX or minY > maxY:
        return image  // å…¨é€æ˜ï¼Œè¿”å›åŸå›¾

    cropWidth = maxX - minX + 1
    cropHeight = maxY - minY + 1

    croppedCanvas = createCanvas(cropWidth, cropHeight)
    croppedCtx = croppedCanvas.getContext('2d')

    croppedCtx.drawImage(
        canvas,
        minX, minY, cropWidth, cropHeight,
        0, 0, cropWidth, cropHeight
    )

    return canvasToImage(croppedCanvas)
```

#### 9.2.3 ä¼˜åŒ–ç­–ç•¥

**1. æ—©åœä¼˜åŒ–**
```javascript
// ä¸€æ—¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªéé€æ˜åƒç´ ï¼Œè®°å½•è¡Œå·ï¼Œå‡å°‘æ‰«æ
let firstNonTransparentRow = -1;
for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
        if (data[...] > 0) {
            firstNonTransparentRow = y;
            break;
        }
    }
    if (firstNonTransparentRow !== -1) break;
}
```

**2. åˆ†å—æ‰«æ**
```javascript
// å…ˆç²—æ‰«ææ‰¾åˆ°å¤§è‡´èŒƒå›´ï¼Œå†ç²¾ç¡®æ‰«æ
const blockSize = 10;
// ... åˆ†å—é€»è¾‘
```

**3. Web Workerå¹¶è¡Œ**
```javascript
// å°†æ‰«æä»»åŠ¡åˆ†é…åˆ°å¤šä¸ªWorker
const workers = [worker1, worker2, worker3, worker4];
// åˆ†åˆ«æ‰«æä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘
```

### 9.3 å›¾ç‰‡ç¼©æ”¾ç®—æ³•

#### 9.3.1 ç­‰æ¯”ç¼©æ”¾è®¡ç®—
```javascript
function calculateScaledSize(imgWidth, imgHeight, maxWidth, maxHeight) {
    let drawWidth = imgWidth;
    let drawHeight = imgHeight;

    // åˆ¤æ–­æ˜¯å¦è¶…å‡ºèŒƒå›´
    if (drawWidth > maxWidth || drawHeight > maxHeight) {
        // è®¡ç®—å®½é«˜æ¯”
        const ratioW = maxWidth / drawWidth;
        const ratioH = maxHeight / drawHeight;

        // å–è¾ƒå°çš„æ¯”ä¾‹ï¼Œç¡®ä¿éƒ½ä¸è¶…å‡º
        const ratio = Math.min(ratioW, ratioH);

        drawWidth *= ratio;
        drawHeight *= ratio;
    }

    return { width: drawWidth, height: drawHeight };
}
```

#### 9.3.2 ç¼©æ”¾è´¨é‡ä¼˜åŒ–
```javascript
// ä½¿ç”¨é«˜è´¨é‡ç¼©æ”¾ç®—æ³•
ctx.imageSmoothingEnabled = true;
ctx.imageSmoothingQuality = 'high';

// å¯¹äºå¤§å›¾ï¼Œä½¿ç”¨å¤šæ­¥ç¼©æ”¾
function downsampleImage(img, targetWidth, targetHeight) {
    let currentWidth = img.width;
    let currentHeight = img.height;

    while (currentWidth > targetWidth * 2 || currentHeight > targetHeight * 2) {
        currentWidth = Math.ceil(currentWidth / 2);
        currentHeight = Math.ceil(currentHeight / 2);

        // ä¸­é—´æ­¥éª¤
        const tempCanvas = createCanvas(currentWidth, currentHeight);
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.drawImage(img, 0, 0, currentWidth, currentHeight);

        img = tempCanvas;
    }

    // æœ€ç»ˆç¼©æ”¾
    const finalCanvas = createCanvas(targetWidth, targetHeight);
    const finalCtx = finalCanvas.getContext('2d');
    finalCtx.drawImage(img, 0, 0, targetWidth, targetHeight);

    return finalCanvas;
}
```

### 9.4 é˜´å½±æ•ˆæœç®—æ³•

```javascript
function applyShadowEffect(ctx, options = {}) {
    const {
        color = 'rgba(0, 0, 0, 0.3)',
        blur = 20,
        offsetX = 5,
        offsetY = 5
    } = options;

    ctx.shadowColor = color;
    ctx.shadowBlur = blur;
    ctx.shadowOffsetX = offsetX;
    ctx.shadowOffsetY = offsetY;
}

// ç»˜åˆ¶åé‡ç½®é˜´å½±
ctx.shadowColor = 'transparent';
ctx.shadowBlur = 0;
ctx.shadowOffsetX = 0;
ctx.shadowOffsetY = 0;
```

---

## 10. UI/UXè®¾è®¡

### 10.1 è®¾è®¡åŸåˆ™

#### 10.1.1 ç®€æ´æ€§ (Simplicity)
- æœ€å°åŒ–æ“ä½œæ­¥éª¤
- æ¸…æ™°çš„è§†è§‰å±‚çº§
- å‡å°‘è®¤çŸ¥è´Ÿæ‹…

#### 10.1.2 ä¸€è‡´æ€§ (Consistency)
- ç»Ÿä¸€çš„è‰²å½©ç³»ç»Ÿ
- ç»Ÿä¸€çš„äº¤äº’æ–¹å¼
- ç»Ÿä¸€çš„æ–‡æ¡ˆé£æ ¼

#### 10.1.3 åé¦ˆæ€§ (Feedback)
- å³æ—¶çš„è§†è§‰åé¦ˆ
- æ¸…æ™°çš„çŠ¶æ€æç¤º
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯

#### 10.1.4 å¯è®¿é—®æ€§ (Accessibility)
- è¶³å¤Ÿçš„ç‚¹å‡»åŒºåŸŸ
- æ¸…æ™°çš„æ–‡å­—å¯¹æ¯”åº¦
- é”®ç›˜å¯¼èˆªæ”¯æŒ

### 10.2 äº¤äº’è®¾è®¡

#### 10.2.1 ä¸Šä¼ äº¤äº’æµç¨‹
```
[åˆå§‹çŠ¶æ€: ä¸Šä¼ æ¡†]
    â†“ ç‚¹å‡» / æ‹–æ‹½
[æ–‡ä»¶é€‰æ‹©å™¨ / æ”¾ä¸‹æ–‡ä»¶]
    â†“
[éªŒè¯æ–‡ä»¶]
    â†“ æˆåŠŸ
[æ˜¾ç¤ºåŠ è½½åŠ¨ç”»]
    â†“
[æ˜¾ç¤ºé¢„è§ˆç¼©ç•¥å›¾]
    â†“
[æ›´æ–°ä¸Šä¼ è®¡æ•°]
```

#### 10.2.2 æ‹–æ‹½äº¤äº’çŠ¶æ€
| çŠ¶æ€ | è§†è§‰æ•ˆæœ | è§¦å‘æ¡ä»¶ |
|------|---------|---------|
| é»˜è®¤ | æ­£å¸¸æ˜¾ç¤º | æ— æ“ä½œ |
| æ‚¬åœ | æ”¾å¤§1.05å€ + é˜´å½± | é¼ æ ‡æ‚¬åœ |
| æ‹–æ‹½ä¸­ | é€æ˜åº¦0.5 | dragstart |
| æ‹–æ‹½ç›®æ ‡ | è“è‰²è¾¹æ¡†é«˜äº® | dragover |
| æ”¾ä¸‹ | äº¤æ¢ä½ç½® + åŠ¨ç”» | drop |

#### 10.2.3 æ»‘å—äº¤äº’ä¼˜åŒ–
```javascript
// é˜²æŠ–ä¼˜åŒ–
let debounceTimer;
slider.addEventListener('input', (e) => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        updatePreview();
    }, 50);  // 50msé˜²æŠ–
});

// æ˜¾ç¤ºå®æ—¶æ•°å€¼
slider.addEventListener('input', (e) => {
    valueDisplay.textContent = e.target.value;
});
```

### 10.3 è§†è§‰è®¾è®¡è§„èŒƒ

#### 10.3.1 æŒ‰é’®çŠ¶æ€
```css
/* ä¸»æŒ‰é’® */
.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
}

.btn-primary:active {
    transform: translateY(0);
}

.btn-primary:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}
```

#### 10.3.2 åŠ è½½åŠ¨ç”»
```css
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
```

#### 10.3.3 è¿‡æ¸¡åŠ¨ç”»
```css
/* æ·¡å…¥ */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* æ»‘å…¥ */
@keyframes slideIn {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.result-section {
    animation: fadeIn 0.5s ease;
}
```

### 10.4 é”™è¯¯æç¤ºè®¾è®¡

#### 10.4.1 æç¤ºçº§åˆ«
| çº§åˆ« | é¢œè‰² | å›¾æ ‡ | ä½¿ç”¨åœºæ™¯ |
|------|-----|------|---------|
| æˆåŠŸ | ç»¿è‰² | âœ“ | ä¸Šä¼ æˆåŠŸã€ç”Ÿæˆå®Œæˆ |
| è­¦å‘Š | é»„è‰² | âš  | åç«¯ä¸å¯ç”¨ |
| é”™è¯¯ | çº¢è‰² | âœ— | æ–‡ä»¶æ ¼å¼é”™è¯¯ |
| ä¿¡æ¯ | è“è‰² | â“˜ | æ“ä½œæç¤º |

#### 10.4.2 Toastæç¤ºç»„ä»¶
```javascript
function showToast(message, type = 'info', duration = 3000) {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;

    document.body.appendChild(toast);

    setTimeout(() => {
        toast.classList.add('show');
    }, 10);

    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, duration);
}
```

---

## 11. å®‰å…¨è®¾è®¡

### 11.1 å‰ç«¯å®‰å…¨

#### 11.1.1 XSSé˜²æŠ¤
```javascript
// æ–‡æœ¬å†…å®¹è½¬ä¹‰
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ç¦æ­¢innerHTMLï¼Œä½¿ç”¨textContent
element.textContent = userInput;  // âœ“ å®‰å…¨
// element.innerHTML = userInput;  // âœ— å±é™©
```

#### 11.1.2 æ–‡ä»¶ç±»å‹éªŒè¯
```javascript
// åŒé‡éªŒè¯ï¼šæ‰©å±•å + MIMEç±»å‹
function validateImageFile(file) {
    // 1. æ£€æŸ¥æ‰©å±•å
    const validExtensions = ['jpg', 'jpeg', 'png'];
    const ext = file.name.split('.').pop().toLowerCase();
    if (!validExtensions.includes(ext)) {
        return false;
    }

    // 2. æ£€æŸ¥MIMEç±»å‹
    if (!file.type.startsWith('image/')) {
        return false;
    }

    // 3. æ£€æŸ¥æ–‡ä»¶å¤§å°
    if (file.size > 10 * 1024 * 1024) {  // 10MB
        return false;
    }

    return true;
}
```

#### 11.1.3 å†…å­˜æ³„æ¼é˜²æŠ¤
```javascript
// URLæ¸…ç†
const url = URL.createObjectURL(blob);
// ... ä½¿ç”¨url
URL.revokeObjectURL(url);  // âœ“ å¿…é¡»æ¸…ç†

// äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
function addUploadListener() {
    const handler = (e) => { /* ... */ };
    uploadBox.addEventListener('click', handler);

    // è¿”å›æ¸…ç†å‡½æ•°
    return () => {
        uploadBox.removeEventListener('click', handler);
    };
}
```

### 11.2 åç«¯å®‰å…¨

#### 11.2.1 æ–‡ä»¶ä¸Šä¼ å®‰å…¨
```python
# æ–‡ä»¶å¤§å°é™åˆ¶
from werkzeug.utils import secure_filename

@app.route('/upload', methods=['POST'])
def upload():
    if 'file' not in request.files:
        return error(400, "æ— æ–‡ä»¶")

    file = request.files['file']

    # å®‰å…¨çš„æ–‡ä»¶å
    filename = secure_filename(file.filename)

    # éªŒè¯æ–‡ä»¶ç±»å‹
    if not allowed_file(filename):
        return error(400, "ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹")

    # éªŒè¯æ–‡ä»¶å¤§å°
    if not validate_file_size(file):
        return error(400, "æ–‡ä»¶è¿‡å¤§")

    # ä¿å­˜åˆ°å®‰å…¨ç›®å½•
    safe_path = os.path.join(UPLOAD_FOLDER, filename)
    file.save(safe_path)

    return success()
```

#### 11.2.2 è·¯å¾„éå†é˜²æŠ¤
```python
import os

def safe_join(directory, filename):
    """å®‰å…¨çš„è·¯å¾„æ‹¼æ¥ï¼Œé˜²æ­¢ç›®å½•éå†æ”»å‡»"""
    filename = secure_filename(filename)
    filepath = os.path.join(directory, filename)

    # ç¡®ä¿è·¯å¾„åœ¨å…è®¸çš„ç›®å½•å†…
    if not os.path.abspath(filepath).startswith(
        os.path.abspath(directory)
    ):
        raise ValueError("éæ³•è·¯å¾„")

    return filepath
```

#### 11.2.3 CORSé…ç½®
```python
from flask_cors import CORS

# ç”Ÿäº§ç¯å¢ƒï¼šé™åˆ¶æ¥æº
CORS(app, resources={
    r"/api/*": {
        "origins": ["https://yourdomain.com"],
        "methods": ["GET", "POST"],
        "allow_headers": ["Content-Type"]
    }
})

# å¼€å‘ç¯å¢ƒï¼šå…è®¸æ‰€æœ‰æ¥æº
CORS(app)
```

### 11.3 æ•°æ®éšç§

#### 11.3.1 æœ¬åœ°å¤„ç†ä¼˜å…ˆ
```
ç”¨æˆ·éšç§æ•°æ®å¤„ç†ç­–ç•¥:
1. ä¹å®«æ ¼å›¾ç‰‡ â†’ çº¯å‰ç«¯å¤„ç† âœ“
2. å›¾ç‰‡åˆæˆ â†’ çº¯å‰ç«¯å¤„ç† âœ“
3. å‚æ•°è°ƒæ•´ â†’ çº¯å‰ç«¯å¤„ç† âœ“
4. ä¸»å›¾æŠ å›¾ â†’ å¿…é¡»åç«¯å¤„ç†ï¼Œä½†ä¸´æ—¶æ–‡ä»¶2å°æ—¶ååˆ é™¤ âš ï¸
```

#### 11.3.2 ä¸´æ—¶æ–‡ä»¶ç®¡ç†
```python
# ä½¿ç”¨UUIDç¡®ä¿æ–‡ä»¶åå”¯ä¸€
import uuid

def save_temp_file(file):
    temp_filename = f"{uuid.uuid4()}.png"
    temp_path = os.path.join(TEMP_DIR, temp_filename)
    file.save(temp_path)

    # è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
    os.chmod(temp_path, 0o600)

    return temp_path

# å®šæ—¶æ¸…ç†
def cleanup_temp_files():
    cutoff = datetime.now() - timedelta(hours=2)
    for filename in os.listdir(TEMP_DIR):
        filepath = os.path.join(TEMP_DIR, filename)
        if os.path.getmtime(filepath) < cutoff.timestamp():
            os.remove(filepath)
```

---

## 12. æ€§èƒ½ä¼˜åŒ–

### 12.1 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 12.1.1 å›¾ç‰‡åŠ è½½ä¼˜åŒ–
```javascript
// å›¾ç‰‡é¢„åŠ è½½
function preloadImages(urls) {
    return Promise.all(
        urls.map(url => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = url;
            });
        })
    );
}

// æ‡’åŠ è½½
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            observer.unobserve(img);
        }
    });
});
```

#### 12.1.2 Canvasæ€§èƒ½ä¼˜åŒ–
```javascript
// 1. ä½¿ç”¨ç¦»å±Canvas
const offscreenCanvas = document.createElement('canvas');
const offscreenCtx = offscreenCanvas.getContext('2d');

// åœ¨ç¦»å±Canvasä¸Šè¿›è¡Œå¤æ‚æ“ä½œ
offscreenCtx.drawImage(...);
offscreenCtx.filter = 'blur(5px)';

// æœ€åä¸€æ¬¡æ€§ç»˜åˆ¶åˆ°ä¸»Canvas
mainCtx.drawImage(offscreenCanvas, 0, 0);

// 2. æ‰¹é‡æ“ä½œ
ctx.save();
ctx.beginPath();
// ... å¤šæ¬¡ç»˜åˆ¶
ctx.closePath();
ctx.restore();

// 3. å‡å°‘çŠ¶æ€åˆ‡æ¢
// âœ— ä¸å¥½
ctx.fillStyle = 'red';
ctx.fillRect(0, 0, 10, 10);
ctx.fillStyle = 'blue';
ctx.fillRect(10, 0, 10, 10);

// âœ“ å¥½
ctx.fillStyle = 'red';
ctx.fillRect(0, 0, 10, 10);
ctx.fillRect(20, 0, 10, 10);
ctx.fillStyle = 'blue';
ctx.fillRect(10, 0, 10, 10);
```

#### 12.1.3 é˜²æŠ–ä¸èŠ‚æµ
```javascript
// é˜²æŠ–ï¼šç­‰å¾…ç”¨æˆ·åœæ­¢æ“ä½œåå†æ‰§è¡Œ
function debounce(func, wait) {
    let timeout;
    return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}

// èŠ‚æµï¼šé™åˆ¶æ‰§è¡Œé¢‘ç‡
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// ä½¿ç”¨
const debouncedUpdate = debounce(updatePreview, 200);
slider.addEventListener('input', debouncedUpdate);
```

#### 12.1.4 èµ„æºå‹ç¼©
```javascript
// å›¾ç‰‡å‹ç¼©
function compressImage(canvas, quality = 0.8) {
    return new Promise((resolve) => {
        canvas.toBlob((blob) => {
            resolve(blob);
        }, 'image/jpeg', quality);
    });
}

// Base64è½¬Blobï¼ˆå‡å°‘å†…å­˜å ç”¨ï¼‰
function dataURLtoBlob(dataURL) {
    const arr = dataURL.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], { type: mime });
}
```

### 12.2 åç«¯æ€§èƒ½ä¼˜åŒ–

#### 12.2.1 æ¨¡å‹ç¼“å­˜
```python
from functools import lru_cache

@lru_cache(maxsize=1)
def get_rembg_session():
    """ç¼“å­˜rembgä¼šè¯ï¼Œé¿å…é‡å¤åŠ è½½æ¨¡å‹"""
    from rembg import new_session
    return new_session("u2net")

def remove_bg_optimized(image_data):
    session = get_rembg_session()
    return remove(image_data, session=session)
```

#### 12.2.2 å¼‚æ­¥å¤„ç†
```python
from concurrent.futures import ThreadPoolExecutor
import asyncio

executor = ThreadPoolExecutor(max_workers=4)

@app.route('/remove_bg_async', methods=['POST'])
async def remove_bg_async():
    file = request.files['image']
    image_data = file.read()

    # å¼‚æ­¥å¤„ç†
    loop = asyncio.get_event_loop()
    result = await loop.run_in_executor(
        executor,
        remove_bg_optimized,
        image_data
    )

    return send_file(io.BytesIO(result), mimetype='image/png')
```

#### 12.2.3 å“åº”å‹ç¼©
```python
from flask_compress import Compress

app = Flask(__name__)
Compress(app)  # è‡ªåŠ¨å‹ç¼©å“åº”
```

### 12.3 ç½‘ç»œä¼˜åŒ–

#### 12.3.1 å‡å°‘è¯·æ±‚æ¬¡æ•°
```javascript
// æ‰¹é‡ä¸Šä¼ ï¼ˆé¢„ç•™ï¼‰
async function batchUpload(files) {
    const formData = new FormData();
    files.forEach((file, index) => {
        formData.append(`image_${index}`, file);
    });

    const response = await fetch('/batch_upload', {
        method: 'POST',
        body: formData
    });

    return response.json();
}
```

#### 12.3.2 è¯·æ±‚è¶…æ—¶æ§åˆ¶
```javascript
// ä½¿ç”¨AbortController
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 10000);

try {
    const response = await fetch(url, {
        signal: controller.signal
    });
    clearTimeout(timeoutId);
    return response;
} catch (error) {
    if (error.name === 'AbortError') {
        console.log('è¯·æ±‚è¶…æ—¶');
    }
}
```

---

## 13. æµ‹è¯•æ–¹æ¡ˆ

### 13.1 æµ‹è¯•ç­–ç•¥

#### 13.1.1 æµ‹è¯•é‡‘å­—å¡”
```
        /\
       /  \  E2Eæµ‹è¯• (5%)
      /â”€â”€â”€â”€\
     /      \  é›†æˆæµ‹è¯• (15%)
    /â”€â”€â”€â”€â”€â”€â”€â”€\
   /          \  å•å…ƒæµ‹è¯• (80%)
  /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
```

### 13.2 å•å…ƒæµ‹è¯•

#### 13.2.1 å‰ç«¯å•å…ƒæµ‹è¯•ï¼ˆJestï¼‰
```javascript
// cropTransparentArea.test.js

describe('cropTransparentArea', () => {
    test('åº”è¯¥æ­£ç¡®è£å‰ªé€æ˜åŒºåŸŸ', async () => {
        // åˆ›å»ºæµ‹è¯•å›¾ç‰‡
        const canvas = createCanvas(100, 100);
        const ctx = canvas.getContext('2d');

        // ä¸­å¿ƒç»˜åˆ¶50x50çº¢è‰²çŸ©å½¢
        ctx.fillStyle = 'red';
        ctx.fillRect(25, 25, 50, 50);

        const img = await canvasToImage(canvas);

        // æ‰§è¡Œè£å‰ª
        const cropped = await cropTransparentArea(img);

        // éªŒè¯å°ºå¯¸
        expect(cropped.width).toBe(50);
        expect(cropped.height).toBe(50);
    });

    test('å…¨é€æ˜å›¾ç‰‡åº”è¿”å›åŸå›¾', async () => {
        const transparentCanvas = createCanvas(100, 100);
        const img = await canvasToImage(transparentCanvas);

        const cropped = await cropTransparentArea(img);

        expect(cropped.width).toBe(img.width);
        expect(cropped.height).toBe(img.height);
    });
});
```

#### 13.2.2 åç«¯å•å…ƒæµ‹è¯•ï¼ˆpytestï¼‰
```python
# test_app.py

import pytest
from app import app, allowed_file

@pytest.fixture
def client():
    app.config['TESTING'] = True
    with app.test_client() as client:
        yield client

def test_health_check(client):
    """æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£"""
    rv = client.get('/health')
    assert rv.status_code == 200
    assert b'ok' in rv.data

def test_allowed_file():
    """æµ‹è¯•æ–‡ä»¶éªŒè¯å‡½æ•°"""
    assert allowed_file('test.jpg') == True
    assert allowed_file('test.png') == True
    assert allowed_file('test.gif') == False
    assert allowed_file('test.exe') == False

def test_remove_bg_no_file(client):
    """æµ‹è¯•æ— æ–‡ä»¶ä¸Šä¼ """
    rv = client.post('/remove_bg')
    assert rv.status_code == 400
```

### 13.3 é›†æˆæµ‹è¯•

#### 13.3.1 APIé›†æˆæµ‹è¯•
```javascript
describe('API Integration Tests', () => {
    test('å®Œæ•´æµç¨‹: ä¸Šä¼  -> æŠ å›¾ -> ä¸‹è½½', async () => {
        // 1. ä¸Šä¼ å›¾ç‰‡
        const formData = new FormData();
        formData.append('image', testImageBlob);

        const uploadRes = await fetch('/upload', {
            method: 'POST',
            body: formData
        });
        expect(uploadRes.ok).toBe(true);

        // 2. è°ƒç”¨æŠ å›¾
        const removeRes = await fetch('/remove_bg', {
            method: 'POST',
            body: formData
        });
        expect(removeRes.ok).toBe(true);

        // 3. éªŒè¯è¿”å›ç±»å‹
        const blob = await removeRes.blob();
        expect(blob.type).toBe('image/png');
    });
});
```

### 13.4 ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆE2Eï¼‰

#### 13.4.1 Playwrightæµ‹è¯•
```javascript
// e2e/complete-flow.spec.js

const { test, expect } = require('@playwright/test');

test('å®Œæ•´ç”¨æˆ·æµç¨‹', async ({ page }) => {
    // 1. è®¿é—®é¡µé¢
    await page.goto('http://localhost:8080');

    // 2. ä¸Šä¼ ä¹å®«æ ¼å›¾ç‰‡
    const gridInput = page.locator('#gridFileInput');
    await gridInput.setInputFiles([
        'test/images/1.jpg',
        'test/images/2.jpg',
        // ... 9å¼ å›¾
    ]);

    // 3. éªŒè¯ä¸Šä¼ è®¡æ•°
    const count = page.locator('#gridCount');
    await expect(count).toHaveText('9');

    // 4. ä¸Šä¼ ä¸»å›¾
    const mainInput = page.locator('#mainFileInput');
    await mainInput.setInputFiles('test/images/main.jpg');

    // 5. è°ƒæ•´å‚æ•°
    await page.locator('#offsetX').fill('100');
    await page.locator('#scale').fill('1.2');

    // 6. ç”Ÿæˆå›¾ç‰‡
    await page.locator('#generateBtn').click();

    // 7. ç­‰å¾…ç”Ÿæˆå®Œæˆ
    await page.waitForSelector('#resultCanvas', { state: 'visible' });

    // 8. ä¸‹è½½å›¾ç‰‡
    const [download] = await Promise.all([
        page.waitForEvent('download'),
        page.locator('#downloadBtn').click()
    ]);

    // 9. éªŒè¯ä¸‹è½½æ–‡ä»¶
    expect(download.suggestedFilename()).toMatch(/3D-ä¹å®«æ ¼-\d+\.jpg/);
});
```

### 13.5 æ€§èƒ½æµ‹è¯•

#### 13.5.1 å‰ç«¯æ€§èƒ½æµ‹è¯•
```javascript
// performance.test.js

test('Canvasæ¸²æŸ“æ€§èƒ½', async () => {
    const start = performance.now();

    await createNineGrid(testImages);

    const end = performance.now();
    const duration = end - start;

    // åº”è¯¥åœ¨100mså†…å®Œæˆ
    expect(duration).toBeLessThan(100);
});
```

#### 13.5.2 åç«¯è´Ÿè½½æµ‹è¯•ï¼ˆLocustï¼‰
```python
# locustfile.py

from locust import HttpUser, task, between

class LoadTestUser(HttpUser):
    wait_time = between(1, 3)

    @task
    def remove_background(self):
        with open('test_image.jpg', 'rb') as f:
            files = {'image': f}
            self.client.post('/remove_bg', files=files)

    @task(3)
    def health_check(self):
        self.client.get('/health')
```

### 13.6 å…¼å®¹æ€§æµ‹è¯•

#### 13.6.1 æµè§ˆå™¨å…¼å®¹æ€§çŸ©é˜µ
| æµè§ˆå™¨ | ç‰ˆæœ¬ | çŠ¶æ€ | å¤‡æ³¨ |
|-------|------|------|------|
| Chrome | 90+ | âœ… é€šè¿‡ | ä¸»è¦å¼€å‘ç¯å¢ƒ |
| Firefox | 88+ | âœ… é€šè¿‡ | - |
| Safari | 14+ | âœ… é€šè¿‡ | Canvas APIå…¼å®¹ |
| Edge | 90+ | âœ… é€šè¿‡ | Chromiumå†…æ ¸ |
| IE 11 | - | âŒ ä¸æ”¯æŒ | ä¸æ”¯æŒES6 |

#### 13.6.2 è®¾å¤‡å…¼å®¹æ€§æµ‹è¯•
- âœ… iPhone 12 Pro (iOS 14)
- âœ… Samsung Galaxy S21 (Android 11)
- âœ… iPad Pro 12.9 (iPadOS 14)
- âœ… Windows 10 PC
- âœ… MacBook Pro (macOS Big Sur)

---

## 14. éƒ¨ç½²æ–¹æ¡ˆ

### 14.1 å¼€å‘ç¯å¢ƒéƒ¨ç½²

#### 14.1.1 å‰ç«¯å¼€å‘ç¯å¢ƒ
```bash
# ä½¿ç”¨Live Serverï¼ˆVSCodeæ’ä»¶ï¼‰
1. å®‰è£…Live Serveræ’ä»¶
2. å³é”®index.html
3. é€‰æ‹©"Open with Live Server"
4. è‡ªåŠ¨æ‰“å¼€ http://localhost:5500
```

#### 14.1.2 åç«¯å¼€å‘ç¯å¢ƒ
```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. å¯åŠ¨Flask
python app.py

# 5. è®¿é—®
# http://localhost:5000
```

### 14.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 14.2.1 å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰
```bash
# 1. å®‰è£…Vercel CLI
npm install -g vercel

# 2. ç™»å½•
vercel login

# 3. éƒ¨ç½²
vercel --prod

# 4. é…ç½®æ–‡ä»¶ vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "index.html",
      "use": "@vercel/static"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/$1"
    }
  ]
}
```

#### 14.2.2 åç«¯éƒ¨ç½²ï¼ˆRenderï¼‰
```yaml
# render.yaml

services:
  - type: web
    name: 3d-grid-backend
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app:app
    envVars:
      - key: PYTHON_VERSION
        value: 3.9.0
      - key: PORT
        value: 5000
```

```bash
# 1. å®‰è£…gunicorn
pip install gunicorn

# 2. æ›´æ–°requirements.txt
echo "gunicorn==20.1.0" >> requirements.txt

# 3. åˆ›å»ºProcfile
echo "web: gunicorn app:app" > Procfile

# 4. æ¨é€åˆ°GitHub
git add .
git commit -m "Deploy to Render"
git push

# 5. åœ¨Renderæ§åˆ¶å°è¿æ¥GitHubä»“åº“å¹¶éƒ¨ç½²
```

#### 14.2.3 Dockeréƒ¨ç½²
```dockerfile
# Dockerfile

FROM python:3.9-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 5000

# å¯åŠ¨å‘½ä»¤
CMD ["gunicorn", "-b", "0.0.0.0:5000", "app:app"]
```

```yaml
# docker-compose.yml

version: '3.8'

services:
  backend:
    build: .
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=production
    volumes:
      - ./temp_images:/app/temp_images
```

```bash
# æ„å»ºå¹¶è¿è¡Œ
docker-compose up --build
```

### 14.3 CDNé…ç½®

#### 14.3.1 é™æ€èµ„æºCDN
```html
<!-- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº -->
<link rel="stylesheet" href="https://cdn.example.com/style.css">
<script src="https://cdn.example.com/app.js"></script>
```

#### 14.3.2 å›¾ç‰‡CDN
```javascript
// é…ç½®å›¾ç‰‡CDNå‰ç¼€
const CDN_PREFIX = 'https://img.example.com';

function getCDNUrl(path) {
    return `${CDN_PREFIX}/${path}`;
}
```

### 14.4 åŸŸåä¸HTTPS

#### 14.4.1 åŸŸåé…ç½®
```
å‰ç«¯: https://3d-grid.example.com
åç«¯: https://api.3d-grid.example.com
```

#### 14.4.2 SSLè¯ä¹¦ï¼ˆLet's Encryptï¼‰
```bash
# ä½¿ç”¨Certbotè‡ªåŠ¨é…ç½®
sudo certbot --nginx -d 3d-grid.example.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## 15. è¿ç»´ç›‘æ§

### 15.1 æ—¥å¿—ç®¡ç†

#### 15.1.1 å‰ç«¯æ—¥å¿—
```javascript
// é”™è¯¯æ—¥å¿—æ”¶é›†
window.addEventListener('error', (event) => {
    const errorLog = {
        message: event.message,
        source: event.filename,
        line: event.lineno,
        col: event.colno,
        error: event.error?.stack,
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString()
    };

    // å‘é€åˆ°æ—¥å¿—æœåŠ¡
    sendToLogService(errorLog);
});

// æ€§èƒ½æ—¥å¿—
window.addEventListener('load', () => {
    const perfData = performance.timing;
    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;

    console.log('é¡µé¢åŠ è½½æ—¶é—´:', pageLoadTime, 'ms');
});
```

#### 15.1.2 åç«¯æ—¥å¿—
```python
import logging
from logging.handlers import RotatingFileHandler

# é…ç½®æ—¥å¿—
handler = RotatingFileHandler(
    'app.log',
    maxBytes=10000000,  # 10MB
    backupCount=5
)

formatter = logging.Formatter(
    '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
handler.setFormatter(formatter)

app.logger.addHandler(handler)
app.logger.setLevel(logging.INFO)

# ä½¿ç”¨
@app.route('/remove_bg', methods=['POST'])
def remove_bg():
    app.logger.info('æ”¶åˆ°æŠ å›¾è¯·æ±‚')
    try:
        # å¤„ç†é€»è¾‘
        app.logger.info('æŠ å›¾å¤„ç†æˆåŠŸ')
        return result
    except Exception as e:
        app.logger.error(f'æŠ å›¾å¤±è´¥: {str(e)}')
        raise
```

### 15.2 æ€§èƒ½ç›‘æ§

#### 15.2.1 å‰ç«¯æ€§èƒ½ç›‘æ§
```javascript
// ä½¿ç”¨Performance API
const observer = new PerformanceObserver((list) => {
    for (const entry of list.getEntries()) {
        console.log('èµ„æº:', entry.name);
        console.log('è€—æ—¶:', entry.duration, 'ms');
    }
});

observer.observe({ entryTypes: ['resource', 'measure'] });

// è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡
performance.mark('generate-start');
await generateImage();
performance.mark('generate-end');
performance.measure('generate', 'generate-start', 'generate-end');
```

#### 15.2.2 åç«¯æ€§èƒ½ç›‘æ§
```python
import time
from functools import wraps

def timing(f):
    """è£…é¥°å™¨ï¼šè®°å½•å‡½æ•°æ‰§è¡Œæ—¶é—´"""
    @wraps(f)
    def wrap(*args, **kwargs):
        start = time.time()
        result = f(*args, **kwargs)
        end = time.time()

        app.logger.info(f'{f.__name__} è€—æ—¶: {end-start:.2f}s')
        return result
    return wrap

@app.route('/remove_bg', methods=['POST'])
@timing
def remove_bg():
    # å¤„ç†é€»è¾‘
    pass
```

### 15.3 å¥åº·æ£€æŸ¥

#### 15.3.1 æœåŠ¡å¥åº·æ£€æŸ¥
```python
@app.route('/health', methods=['GET'])
def health():
    """å¥åº·æ£€æŸ¥æ¥å£"""
    checks = {
        'status': 'healthy',
        'timestamp': datetime.now().isoformat(),
        'checks': {
            'disk_space': check_disk_space(),
            'memory': check_memory(),
            'model_loaded': check_model()
        }
    }

    return jsonify(checks)

def check_disk_space():
    """æ£€æŸ¥ç£ç›˜ç©ºé—´"""
    import shutil
    total, used, free = shutil.disk_usage("/")
    free_percent = free / total * 100
    return {
        'status': 'ok' if free_percent > 10 else 'warning',
        'free_percent': f'{free_percent:.2f}%'
    }
```

### 15.4 å‘Šè­¦æœºåˆ¶

#### 15.4.1 é”™è¯¯å‘Šè­¦
```python
# é”™è¯¯è¶…è¿‡é˜ˆå€¼æ—¶å‘é€é‚®ä»¶
from flask import g

@app.before_request
def before_request():
    g.start_time = time.time()

@app.after_request
def after_request(response):
    diff = time.time() - g.start_time

    # å“åº”æ—¶é—´è¿‡é•¿å‘Šè­¦
    if diff > 10:
        send_alert_email(
            subject='å“åº”æ—¶é—´è¿‡é•¿',
            body=f'æ¥å£ {request.path} è€—æ—¶ {diff:.2f}s'
        )

    return response
```

### 15.5 å¤‡ä»½ç­–ç•¥

#### 15.5.1 ä»£ç å¤‡ä»½
```bash
# Gitç‰ˆæœ¬æ§åˆ¶
git add .
git commit -m "Backup: $(date +%Y-%m-%d)"
git push origin main

# è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d)
BACKUP_DIR="/backups"

# æ‰“åŒ…ä»£ç 
tar -czf $BACKUP_DIR/code-$DATE.tar.gz .

# ä¿ç•™æœ€è¿‘7å¤©
find $BACKUP_DIR -name "code-*.tar.gz" -mtime +7 -delete
```

#### 15.5.2 æ•°æ®å¤‡ä»½
```bash
# å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶å‰å¤‡ä»½é‡è¦æ•°æ®
rsync -avz temp_images/ /backup/temp_images_$(date +%Y%m%d)/
```

---

## é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è§£é‡Š |
|------|------|------|
| ä¹å®«æ ¼ | Nine Grid | 3x3æ’åˆ—çš„å›¾ç‰‡å¸ƒå±€ |
| æŠ å›¾ | Background Removal | å»é™¤å›¾ç‰‡èƒŒæ™¯ |
| 3Då‡ºæ ¼ | 3D Pop-out Effect | ä¸»å›¾çªå‡ºäºèƒŒæ™¯çš„è§†è§‰æ•ˆæœ |
| Canvas | Canvas | HTML5ç”»å¸ƒå…ƒç´  |
| Base64 | Base64 | å›¾ç‰‡ç¼–ç æ ¼å¼ |
| Blob | Binary Large Object | äºŒè¿›åˆ¶å¤§å¯¹è±¡ |
| CORS | Cross-Origin Resource Sharing | è·¨åŸŸèµ„æºå…±äº« |

### B. å‚è€ƒèµ„æ–™

- [MDN Web Docs - Canvas API](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API)
- [Flask Documentation](https://flask.palletsprojects.com/)
- [rembg GitHub](https://github.com/danielgatis/rembg)
- [Pillow Documentation](https://pillow.readthedocs.io/)

### C. å¸¸è§é—®é¢˜FAQ

**Q1: ä¸ºä»€ä¹ˆæŠ å›¾éœ€è¦åç«¯å¤„ç†ï¼Ÿ**
A: rembgæ˜¯Pythonåº“ï¼Œæ— æ³•åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚æœªæ¥å¯è€ƒè™‘ä½¿ç”¨TensorFlow.jså®ç°çº¯å‰ç«¯æŠ å›¾ã€‚

**Q2: å¦‚ä½•æé«˜æŠ å›¾è´¨é‡ï¼Ÿ**
A: å¯è°ƒæ•´rembgçš„alpha_mattingå‚æ•°ï¼Œæˆ–ä½¿ç”¨æ›´é«˜çº§çš„æ¨¡å‹ï¼ˆå¦‚SAMï¼‰ã€‚

**Q3: æ”¯æŒè§†é¢‘å¤„ç†å—ï¼Ÿ**
A: å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒé™æ€å›¾ç‰‡ã€‚è§†é¢‘å¤„ç†éœ€è¦é€å¸§æŠ å›¾ï¼Œæ€§èƒ½è¦æ±‚é«˜ã€‚

**Q4: å¦‚ä½•å¤„ç†å¤§å›¾ç‰‡ï¼Ÿ**
A: å‰ç«¯å¯å…ˆå‹ç¼©å›¾ç‰‡ï¼Œæˆ–ä½¿ç”¨Web Workerå¼‚æ­¥å¤„ç†ã€‚

**Q5: èƒ½å¦å¯¼å‡ºPSDæ ¼å¼ï¼Ÿ**
A: å½“å‰ä»…æ”¯æŒJPEG/PNGã€‚PSDéœ€è¦å¤æ‚çš„å›¾å±‚ç»“æ„ï¼Œå¯è€ƒè™‘åç»­ç‰ˆæœ¬å®ç°ã€‚

---

**æ–‡æ¡£ç»“æŸ**

> æœ¬æ–‡æ¡£æè¿°äº†AIä¹å®«æ ¼3Då‡ºå›¾ç³»ç»Ÿ v1.0 çš„å®Œæ•´è®¾è®¡æ–¹æ¡ˆï¼Œæ¶µç›–æ¶æ„ã€åŠŸèƒ½ã€æ¥å£ã€ç®—æ³•ã€å®‰å…¨ã€æ€§èƒ½ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰å„ä¸ªæ–¹é¢ã€‚
>
> **ç‰ˆæœ¬å†å²**:
> - v1.0 (2025-10-18): åˆå§‹ç‰ˆæœ¬

**æ’°å†™äºº**: å¤§é“­DAMING
**å®¡æ ¸äºº**: -
**æ‰¹å‡†äºº**: -
